<html>
<head>
<title>Sihi olud</title>
<style type="text/css">
.bignumber {
	font-size: xx-large;
	font-family: sans-serif;
}
</style>
</head>
<body>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<input type="text" width="2" id="hours" value="8"><input type="button" value="... viimast tundi" onclick="lae()">
<div id="chart_div"></div>
<span id="lasttemp" class="bignumber"></span>&nbsp;&nbsp;&nbsp;<span id="lasthum" class="bignumber"></span>
<script type="text/javascript">

var tempData = new Array();
$(document).ready(function() {
});

google.charts.load('current', {packages: ['corechart', 'line']});
google.charts.setOnLoadCallback(drawBasic);

function lae() {
	drawBasic();
}

function drawBasic() {
		var jsonData = $.ajax({
		    url: "/temperature?hours=" + $("#hours").val(),
		    dataType: "json",
		    async: false
		}).responseJSON.temperatures;
		
		$("#lasttemp").html(jsonData[jsonData.length - 1][1] + " °C,");
		$("#lasthum").html(jsonData[jsonData.length - 1][2] + "%");
		
		for (var i = 0 ; i < jsonData.length ; i++) {
			jsonData[i][0] = new Date(jsonData[i][0]);
		}
/* 		var dateFormatter = new google.visualization.DateFormat({pattern: 'MM.dd HH:mm'});
		dateFormatter.format(jsonData, 0);
 */		

      var data = new google.visualization.DataTable();

      data.addColumn('datetime', 'Aeg');
      data.addColumn('number', 'temperatuur');
      data.addColumn('number', 'õhuniiskus');

      data.addRows(jsonData);
      
      var options = {
        series: {
        	0: {axis: 'Temperatuur'},
        	1: {axis: 'Niiskus'}
        },
        axes: {
        	x: {
        		title: 'Aeg',
        		format: 'MM.dd HH:mm'
        	},
        	y: {
        		Temperatuur: {
        			label: 'Temperatuur'
        		},
        		Niiskus: {
        			label: 'Suhteline õhuniiskus'
        		}
        	}
        }
      };

//      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      var chart = new google.charts.Line(document.getElementById('chart_div'));

      chart.draw(data, options);
    }
</script>
</body>
</html>